<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Data Collection Module

This module is used to deploy Data Collection Rules (DCR) and Data Collection Endpoints (DCE) for Azure Monitor.

## Features

- Deploy Data Collection Rules (DCR)
- Deploy Data Collection Endpoints (DCE)
- Support for Windows and Linux data sources
- Support for Performance Counters and Metrics
- Management Lock support

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (~> 1.5)

- <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) (~> 2.4)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (>= 3.71, < 5.0.0)

## Resources

The following resources are used by this module:

- [azapi_resource.data_collection_endpoint](https://registry.terraform.io/providers/azure/azapi/latest/docs/resources/resource) (resource)
- [azapi_resource.data_collection_rule](https://registry.terraform.io/providers/azure/azapi/latest/docs/resources/resource) (resource)
- [azapi_resource.data_collection_rule_association](https://registry.terraform.io/providers/azure/azapi/latest/docs/resources/resource) (resource)
- [azapi_resource.dce_nsp_association](https://registry.terraform.io/providers/azure/azapi/latest/docs/resources/resource) (resource)
- [azurerm_management_lock.data_collection_endpoint](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_lock) (resource)
- [azurerm_management_lock.data_collection_rule](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_lock) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

The following input variables are required:

### <a name="input_location"></a> [location](#input\_location)

Description: (Required) The Azure region where the resources should be deployed.

Type: `string`

### <a name="input_log_analytics_workspace_resource_id"></a> [log\_analytics\_workspace\_resource\_id](#input\_log\_analytics\_workspace\_resource\_id)

Description: (Required) The Resource ID of the Log Analytics Workspace to associate with the Data Collection Rules.

Type: `string`

### <a name="input_resource_group_id"></a> [resource\_group\_id](#input\_resource\_group\_id)

Description: (Required) The Resource ID of the Resource Group where the resources will be deployed.

Type: `string`

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_data_collection_endpoints"></a> [data\_collection\_endpoints](#input\_data\_collection\_endpoints)

Description: (Optional) A map of Data Collection Endpoints to create. The key is the name of the endpoint. The value is an object containing the configuration.
- `name` - (Required) The name of the Data Collection Endpoint.
- `description` - (Optional) The description of the Data Collection Endpoint.
- `public_network_access_enabled` - (Optional) Whether public network access is enabled. Possible values are `Enabled`, `Disabled`, and `SecuredByPerimeter`. Defaults to `Enabled`.
- `tags` - (Optional) A map of tags to assign to the Data Collection Endpoint.
- `network_security_perimeter_association` - (Optional) An object defining the Network Security Perimeter association.
  - `resource_id` - (Required) The Resource ID of the Network Security Perimeter.
  - `profile_name` - (Required) The name of the Network Security Perimeter Profile.
  - `access_mode` - (Required) The access mode for the Network Security Perimeter.
- `lock` - (Optional) Controls the Resource Lock configuration for this resource. The following properties can be specified:
  - `kind` - (Required) The type of lock. Possible values are `CanNotDelete` and `ReadOnly`.
  - `name` - (Optional) The name of the lock. If not specified, a name will be generated based on the `kind` value. Changing this forces the creation of a new resource.

Type:

```hcl
map(object({
    name                          = string
    description                   = optional(string)
    public_network_access_enabled = optional(string, "Enabled")
    tags                          = optional(map(string))
    network_security_perimeter_association = optional(object({
      resource_id  = string
      profile_name = string
      access_mode  = string
    }))
    lock = optional(object({
      kind = string
      name = optional(string, null)
    }))
  }))
```

Default: `{}`

### <a name="input_data_collection_rule_associations"></a> [data\_collection\_rule\_associations](#input\_data\_collection\_rule\_associations)

Description: (Optional) A map of Data Collection Rule Associations to create. The key is the name of the association. The value is an object containing the configuration.
- `name` - (Required) The name of the Data Collection Rule Association.
- `target_resource_id` - (Required) The Resource ID of the target resource.
- `data_collection_rule_id` - (Optional) The Resource ID of the Data Collection Rule.
- `data_collection_endpoint_id` - (Optional) The Resource ID of the Data Collection Endpoint.
- `data_collection_rule_name` - (Optional) The name of the Data Collection Rule to associate (if created in this module).
- `data_collection_endpoint_name` - (Optional) The name of the Data Collection Endpoint to associate (if created in this module).
- `description` - (Optional) The description of the Data Collection Rule Association.

Type:

```hcl
map(object({
    name                          = string
    target_resource_id            = string
    data_collection_rule_id       = optional(string)
    data_collection_endpoint_id   = optional(string)
    data_collection_rule_name     = optional(string)
    data_collection_endpoint_name = optional(string)
    description                   = optional(string)
  }))
```

Default: `{}`

### <a name="input_data_collection_rules"></a> [data\_collection\_rules](#input\_data\_collection\_rules)

Description: (Optional) A map of Data Collection Rules to create. The key is the name of the rule. The value is an object containing the configuration.
- `name` - (Required) The name of the Data Collection Rule.
- `kind` - (Optional) The kind of the Data Collection Rule. Possible values are `Linux`, `Windows`, and `AgentDirectToStore`.
- `description` - (Optional) The description of the Data Collection Rule.
- `tags` - (Optional) A map of tags to assign to the Data Collection Rule.
- `lock` - (Optional) Controls the Resource Lock configuration for this resource. The following properties can be specified:
  - `kind` - (Required) The type of lock. Possible values are `CanNotDelete` and `ReadOnly`.
  - `name` - (Optional) The name of the lock. If not specified, a name will be generated based on the `kind` value. Changing this forces the creation of a new resource.
- `data_sources` - (Optional) An object defining the data sources.
  - `performanceCounters` - (Optional) A list of performance counters.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
    - `samplingFrequencyInSeconds` - (Required) The sampling frequency in seconds.
    - `counterSpecifiers` - (Required) A list of counter specifiers.
  - `windowsEventLogs` - (Optional) A list of Windows Event Logs.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
    - `xPathQueries` - (Required) A list of XPath queries.
  - `syslog` - (Optional) A list of Syslog configurations.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
    - `facilityNames` - (Required) A list of facility names. Possible values include `auth`, `authpriv`, `cron`, `daemon`, `kern`, `lpr`, `mail`, `mark`, `news`, `syslog`, `user`, `uucp`, `local0` through `local7`.
    - `logLevels` - (Required) A list of log levels. Possible values include `Debug`, `Info`, `Notice`, `Warning`, `Error`, `Critical`, `Alert`, `Emergency`.
  - `extensions` - (Optional) A list of extensions.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
    - `extensionName` - (Required) The name of the extension.
    - `extensionSettings` - (Optional) The settings for the extension.
    - `inputDataSources` - (Optional) A list of input data sources.
  - `platformTelemetry` - (Optional) A list of platform telemetry configurations.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
  - `prometheusForwarder` - (Optional) A list of Prometheus Forwarder configurations.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
    - `labelIncludeFilter` - (Optional) A map of label include filters.
  - `iisLogs` - (Optional) A list of IIS Logs configurations.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
    - `logDirectories` - (Optional) A list of log directories.
  - `logFiles` - (Optional) A list of Log Files configurations.
    - `name` - (Required) The name of the data source.
    - `streams` - (Required) A list of streams.
    - `filePatterns` - (Required) A list of file patterns.
    - `format` - (Required) The format of the log files.
    - `settings` - (Optional) The settings for the log files.
      - `text` - (Optional) Text settings.
        - `recordStartTimestampFormat` - (Required) The record start timestamp format.
- `destinations` - (Optional) An object defining the destinations.
  - `logAnalytics` - (Optional) A list of Log Analytics destinations.
    - `name` - (Required) The name of the destination.
    - `workspaceResourceId` - (Optional) The Resource ID of the Log Analytics Workspace. If not provided, the module's workspace is used.
  - `azureMonitorMetrics` - (Optional) An Azure Monitor Metrics destination.
    - `name` - (Required) The name of the destination.
  - `eventHubs` - (Optional) A list of Event Hub destinations.
    - `name` - (Required) The name of the destination.
    - `eventHubResourceId` - (Required) The Resource ID of the Event Hub.
  - `storageBlobsDirect` - (Optional) A list of Storage Blob destinations.
    - `name` - (Required) The name of the destination.
    - `storageAccountResourceId` - (Required) The Resource ID of the Storage Account.
    - `containerName` - (Required) The name of the container.
  - `storageTablesDirect` - (Optional) A list of Storage Table destinations.
    - `name` - (Required) The name of the destination.
    - `storageAccountResourceId` - (Required) The Resource ID of the Storage Account.
    - `tableName` - (Required) The name of the table.
- `data_flows` - (Optional) A list of data flows.
  - `streams` - (Required) A list of streams.
  - `destinations` - (Required) A list of destinations.
  - `transformKql` - (Optional) The KQL transformation query.
  - `outputStream` - (Optional) The output stream.
- `stream_declarations` - (Optional) A map of stream declarations.
  - `columns` - (Required) A list of columns.
    - `name` - (Required) The name of the column.
    - `type` - (Required) The type of the column.

Type:

```hcl
map(object({
    name        = string
    kind        = optional(string)
    description = optional(string)
    tags        = optional(map(string))
    lock = optional(object({
      kind = string
      name = optional(string, null)
    }))
    data_sources = optional(object({
      performanceCounters = optional(list(object({
        name                       = string
        streams                    = list(string)
        samplingFrequencyInSeconds = number
        counterSpecifiers          = list(string)
      })))
      windowsEventLogs = optional(list(object({
        name         = string
        streams      = list(string)
        xPathQueries = list(string)
      })))
      syslog = optional(list(object({
        name          = string
        streams       = list(string)
        facilityNames = list(string)
        logLevels     = list(string)
      })))
      extensions = optional(list(object({
        name              = string
        streams           = list(string)
        extensionName     = string
        extensionSettings = optional(any)
        inputDataSources  = optional(list(string))
      })))
      platformTelemetry = optional(list(object({
        name    = string
        streams = list(string)
      })))
      prometheusForwarder = optional(list(object({
        name               = string
        streams            = list(string)
        labelIncludeFilter = optional(map(string))
      })))
      iisLogs = optional(list(object({
        name           = string
        streams        = list(string)
        logDirectories = optional(list(string))
      })))
      logFiles = optional(list(object({
        name         = string
        streams      = list(string)
        filePatterns = list(string)
        format       = string
        settings = optional(object({
          text = optional(object({
            recordStartTimestampFormat = string
          }))
        }))
      })))
    }))
    destinations = optional(object({
      logAnalytics = optional(list(object({
        name                = string
        workspaceResourceId = optional(string)
      })))
      azureMonitorMetrics = optional(object({
        name = string
      }))
      eventHubs = optional(list(object({
        name               = string
        eventHubResourceId = string
      })))
      storageBlobsDirect = optional(list(object({
        name                     = string
        storageAccountResourceId = string
        containerName            = string
      })))
      storageTablesDirect = optional(list(object({
        name                     = string
        storageAccountResourceId = string
        tableName                = string
      })))
    }))
    data_flows = optional(list(object({
      streams      = list(string)
      destinations = list(string)
      transformKql = optional(string)
      outputStream = optional(string)
    })))
    stream_declarations = optional(map(object({
      columns = list(object({
        name = string
        type = string
      }))
    })))
  }))
```

Default: `{}`

### <a name="input_tags"></a> [tags](#input\_tags)

Description: (Optional) A map of tags to assign to the resources.

Type: `map(string)`

Default: `{}`

## Outputs

The following outputs are exported:

### <a name="output_data_collection_endpoint_ids"></a> [data\_collection\_endpoint\_ids](#output\_data\_collection\_endpoint\_ids)

Description: The Resource IDs of the Data Collection Endpoints.

### <a name="output_data_collection_rule_association_ids"></a> [data\_collection\_rule\_association\_ids](#output\_data\_collection\_rule\_association\_ids)

Description: The Resource IDs of the Data Collection Rule Associations.

### <a name="output_data_collection_rule_ids"></a> [data\_collection\_rule\_ids](#output\_data\_collection\_rule\_ids)

Description: The Resource IDs of the Data Collection Rules.

## Modules

No modules.

<!-- markdownlint-disable-next-line MD041 -->
## Data Collection

The software may collect information about you and your use of the software and send it to Microsoft. Microsoft may use this information to provide services and improve our products and services. You may turn off the telemetry as described in the repository. There are also some features in the software that may enable you and Microsoft to collect data from users of your applications. If you use these features, you must comply with applicable law, including providing appropriate notices to users of your applications together with a copy of Microsoftâ€™s privacy statement. Our privacy statement is located at <https://go.microsoft.com/fwlink/?LinkID=824704>. You can learn more about data collection and use in the help documentation and our privacy statement. Your use of the software operates as your consent to these practices.
<!-- END_TF_DOCS -->