<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# Query Packs Deployment Example

This example demonstrates how to deploy Azure Monitor Query Packs and Queries using the `query_packs` module.

It deploys the following resources:
- A **Log Analytics Workspace** as the foundational resource.
- A **Query Pack** named `my-query-pack` tagged for a dev environment and protected with a `CanNotDelete` lock.
- A **Monitor Query** named `My Query` inside the pack:
  - Executes `Heartbeat | take 10`.
  - Categorized under "monitor".
  - Automatically assigned a UUID if one is not provided.

```hcl
terraform {
  required_version = ">= 1.3.0"

  required_providers {
    azapi = {
      source  = "azure/azapi"
      version = "~> 2.4"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = ">= 3.71, < 5.0.0"
    }
    random = {
      source  = "hashicorp/random"
      version = ">= 3.5.0, < 4.0.0"
    }
  }
}

provider "azurerm" {
  features {}
}

# This ensures we have unique CAF compliant names for our resources.
module "naming" {
  source  = "Azure/naming/azurerm"
  version = "0.3.0"
}

# This picks a random region from the list of regions.
resource "random_integer" "region_index" {
  max = length(local.azure_regions) - 1
  min = 0
}

# This is required for resource modules
resource "azurerm_resource_group" "rg" {
  location = local.azure_regions[random_integer.region_index.result]
  name     = module.naming.resource_group.name_unique
}

# This is the module call
module "log_analytics_workspace" {
  source = "../../"

  location            = azurerm_resource_group.rg.location
  name                = "thislaworkspace"
  resource_group_name = azurerm_resource_group.rg.name
  enable_telemetry    = var.enable_telemetry
  log_analytics_workspace_identity = {
    type = "SystemAssigned"
  }
  log_analytics_workspace_retention_in_days = 30
  log_analytics_workspace_sku               = "PerGB2018"
}

module "query_packs" {
  source = "../../modules/query_packs"

  location          = azurerm_resource_group.rg.location
  resource_group_id = azurerm_resource_group.rg.id
  monitor_queries = {
    "query1" = {
      query_pack_key = "pack1"
      display_name   = "My Query"
      body           = "Heartbeat | take 10"
      description    = "Sample query"
      related = {
        categories = ["monitor"]
      }
    }
  }
  monitor_query_packs = {
    "pack1" = {
      name = "my-query-pack"
      tags = { env = "dev" }
      lock = {
        kind = "CanNotDelete"
      }
    }
  }
}
```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.3.0)

- <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) (~> 2.4)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (>= 3.71, < 5.0.0)

- <a name="requirement_random"></a> [random](#requirement\_random) (>= 3.5.0, < 4.0.0)

## Resources

The following resources are used by this module:

- [azurerm_resource_group.rg](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [random_integer.region_index](https://registry.terraform.io/providers/hashicorp/random/latest/docs/resources/integer) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

No required inputs.

## Optional Inputs

The following input variables are optional (have default values):

### <a name="input_enable_telemetry"></a> [enable\_telemetry](#input\_enable\_telemetry)

Description: This variable controls whether or not telemetry is enabled for the module.  
For more information see https://aka.ms/avm/telemetryinfo.  
If it is set to false, then no telemetry will be collected.

Type: `bool`

Default: `true`

## Outputs

No outputs.

## Modules

The following Modules are called:

### <a name="module_log_analytics_workspace"></a> [log\_analytics\_workspace](#module\_log\_analytics\_workspace)

Source: ../../

Version:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: Azure/naming/azurerm

Version: 0.3.0

### <a name="module_query_packs"></a> [query\_packs](#module\_query\_packs)

Source: ../../modules/query_packs

Version:

<!-- markdownlint-disable-next-line MD033 -->
[Return to the main README](../../README.md)
<!-- END_TF_DOCS -->